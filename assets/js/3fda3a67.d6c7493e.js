"use strict";(globalThis.webpackChunkdocs_enclave_kubernerdes_com=globalThis.webpackChunkdocs_enclave_kubernerdes_com||[]).push([[568],{2512(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"day-2/day-2","title":"Day 2 \u2014 Operate","description":"Day 2 is everything that happens after the initial deployment \u2014 keeping the enclave healthy, backed up, and diagnosable.","source":"@site/docs/day-2/index.md","sourceDirName":"day-2","slug":"/day-2/","permalink":"/docs/day-2/","draft":false,"unlisted":false,"editUrl":"https://github.com/jradtke-rgs/docs.enclave.kubernerdes.com/edit/main/docs/day-2/index.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"day-2","title":"Day 2 \u2014 Operate","sidebar_label":"Overview","sidebar_position":1},"sidebar":"enclaveSidebar","previous":{"title":"Rancher Manager","permalink":"/docs/day-1/rancher-manager"},"next":{"title":"Monitoring","permalink":"/docs/day-2/monitoring"}}');var s=r(4848),d=r(8453);const a={id:"day-2",title:"Day 2 \u2014 Operate",sidebar_label:"Overview",sidebar_position:1},i="Day 2 \u2014 Operate",c={},l=[{value:"Operations Areas",id:"operations-areas",level:2},{value:"Operational Principles",id:"operational-principles",level:2},{value:"Know Your Blast Radius",id:"know-your-blast-radius",level:3},{value:"Change Management",id:"change-management",level:3},{value:"Patching Cadence",id:"patching-cadence",level:3},{value:"Day 2 Runbooks",id:"day-2-runbooks",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"day-2--operate",children:"Day 2 \u2014 Operate"})}),"\n",(0,s.jsx)(n.p,{children:"Day 2 is everything that happens after the initial deployment \u2014 keeping the enclave healthy, backed up, and diagnosable."}),"\n",(0,s.jsx)(n.h2,{id:"operations-areas",children:"Operations Areas"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Topic"}),(0,s.jsx)(n.th,{children:"Document"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Dashboards, metrics, health monitoring"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/docs/day-2/monitoring",children:"Monitoring"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Backups, config management, Ansible"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/docs/day-2/backup-maintenance",children:"Backup & Maintenance"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Common issues, kubectl snippets, cert debugging"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/docs/day-2/troubleshooting",children:"Troubleshooting"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"operational-principles",children:"Operational Principles"}),"\n",(0,s.jsx)(n.h3,{id:"know-your-blast-radius",children:"Know Your Blast Radius"}),"\n",(0,s.jsx)(n.p,{children:"The enclave is a 3-node Harvester cluster using etcd for distributed state. Understand the failure modes:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Failure"}),(0,s.jsx)(n.th,{children:"Impact"}),(0,s.jsx)(n.th,{children:"Recovery"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1 Harvester node down"}),(0,s.jsx)(n.td,{children:"Cluster continues (2/3 quorum)"}),(0,s.jsx)(n.td,{children:"Bring node back up; auto-recovers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2+ Harvester nodes down"}),(0,s.jsx)(n.td,{children:"Cluster halted (no quorum)"}),(0,s.jsx)(n.td,{children:"Manual etcd recovery required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"infra-01 (DHCP/DNS) down"}),(0,s.jsx)(n.td,{children:"New DHCP leases fail; DNS fails"}),(0,s.jsx)(n.td,{children:"Restart VM; existing connections survive"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"infra-02 (HAProxy/Keepalived) down"}),(0,s.jsx)(n.td,{children:"VIPs go offline"}),(0,s.jsx)(n.td,{children:"Restart VM or promote backup"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"nuc-00 down"}),(0,s.jsx)(n.td,{children:"infra VMs offline; PXE unavailable"}),(0,s.jsx)(n.td,{children:"Bring nuc-00 back up"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"change-management",children:"Change Management"}),"\n",(0,s.jsx)(n.p,{children:"Treat the enclave like production:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Test changes on a single node before rolling to all three"}),"\n",(0,s.jsxs)(n.li,{children:["Keep the Ansible playbooks in version control; commit before ",(0,s.jsx)(n.strong,{children:"and"})," after changes"]}),"\n",(0,s.jsx)(n.li,{children:"Document any manual changes immediately \u2014 the next person (future you) needs to know"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"patching-cadence",children:"Patching Cadence"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Cadence"}),(0,s.jsx)(n.th,{children:"Method"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"openSUSE Leap 15.5 (nuc-00, VMs)"}),(0,s.jsx)(n.td,{children:"Monthly"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"zypper update -y"})," via Ansible"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Harvester"}),(0,s.jsx)(n.td,{children:"Per release"}),(0,s.jsx)(n.td,{children:"Harvester UI upgrade wizard"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Rancher Manager"}),(0,s.jsx)(n.td,{children:"Per release"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"helm upgrade"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"K3s (on rancher-mgr)"}),(0,s.jsx)(n.td,{children:"With Rancher"}),(0,s.jsx)(n.td,{children:"Auto or manual"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"cert-manager"}),(0,s.jsx)(n.td,{children:"Quarterly"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"helm upgrade"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"day-2-runbooks",children:"Day 2 Runbooks"}),"\n",(0,s.jsx)(n.p,{children:"Quick reference for common tasks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check overall cluster health\nkubectl get nodes\nkubectl get pods -A | grep -v Running | grep -v Completed\n\n# Check Rancher pods\nkubectl --kubeconfig ~/.kube/rancher-k3s-config get pods -n cattle-system\n\n# Restart a stuck VM in Harvester\nvirtctl restart <vm-name> -n <namespace>\n\n# Force-drain a Harvester node for maintenance\nkubectl drain nuc-02 --ignore-daemonsets --delete-emptydir-data\n# After maintenance:\nkubectl uncordon nuc-02\n"})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>a,x:()=>i});var t=r(6540);const s={},d=t.createContext(s);function a(e){const n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);