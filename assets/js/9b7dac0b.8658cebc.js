"use strict";(globalThis.webpackChunkdocs_enclave_kubernerdes_com=globalThis.webpackChunkdocs_enclave_kubernerdes_com||[]).push([[497],{5469(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"day-1/admin-host","title":"Admin Host Setup","description":"nuc-00 is the foundation of the enclave. It runs:","source":"@site/docs/day-1/admin-host.md","sourceDirName":"day-1","slug":"/day-1/admin-host","permalink":"/docs/day-1/admin-host","draft":false,"unlisted":false,"editUrl":"https://github.com/jradtke-rgs/docs.enclave.kubernerdes.com/edit/main/docs/day-1/admin-host.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"admin-host","title":"Admin Host Setup","sidebar_label":"Admin Host","sidebar_position":2},"sidebar":"enclaveSidebar","previous":{"title":"Overview","permalink":"/docs/day-1/"},"next":{"title":"Infrastructure VMs","permalink":"/docs/day-1/infrastructure-vms"}}');var r=t(4848),i=t(8453);const a={id:"admin-host",title:"Admin Host Setup",sidebar_label:"Admin Host",sidebar_position:2},l="Admin Host Setup (nuc-00)",d={},c=[{value:"1. openSUSE Leap 15.5 Installation",id:"1-opensuse-leap-155-installation",level:2},{value:"2. System Preparation",id:"2-system-preparation",level:2},{value:"3. LVM Setup for VM Disks",id:"3-lvm-setup-for-vm-disks",level:2},{value:"4. Apache PXE HTTP Server",id:"4-apache-pxe-http-server",level:2},{value:"5. TFTP PXE Boot Server",id:"5-tftp-pxe-boot-server",level:2},{value:"6. SSH Key Distribution",id:"6-ssh-key-distribution",level:2},{value:"7. Verification",id:"7-verification",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"admin-host-setup-nuc-00",children:"Admin Host Setup (nuc-00)"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"nuc-00"})," is the foundation of the enclave. It runs:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"KVM/libvirt"})," \u2014 hypervisor for infrastructure VMs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apache httpd"})," \u2014 serves Harvester ISO and kickstart files via HTTP"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TFTP"})," \u2014 serves PXE boot files (pxelinux, iPXE)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"LVM"})," \u2014 flexible storage for VM disks"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-opensuse-leap-155-installation",children:"1. openSUSE Leap 15.5 Installation"}),"\n",(0,r.jsxs)(n.p,{children:["Boot ",(0,r.jsx)(n.code,{children:"nuc-00"})," from the openSUSE Leap 15.5 ISO. Use the YaST installer TUI or an AutoYaST profile for automated installation."]}),"\n",(0,r.jsx)(n.p,{children:"Partition layout:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Mount"}),(0,r.jsx)(n.th,{children:"Size"}),(0,r.jsx)(n.th,{children:"Type"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/boot/efi"})}),(0,r.jsx)(n.td,{children:"512 MB"}),(0,r.jsx)(n.td,{children:"EFI System"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/boot"})}),(0,r.jsx)(n.td,{children:"1 GB"}),(0,r.jsx)(n.td,{children:"ext4"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/"})}),(0,r.jsx)(n.td,{children:"100 GB"}),(0,r.jsx)(n.td,{children:"ext4 (LVM)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"(LVM PV)"})}),(0,r.jsx)(n.td,{children:"Remaining"}),(0,r.jsx)(n.td,{children:"LVM Physical Volume"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"After installation, set a static IP:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# /etc/NetworkManager/system-connections/eth0.nmconnection\n[ipv4]\nmethod=manual\naddresses=10.10.12.10/22\ngateway=10.10.12.1\ndns=8.8.8.8  # temporary until nuc-00-01 is up\n"})}),"\n",(0,r.jsx)(n.p,{children:"Apply and verify:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nmcli connection reload\nnmcli connection up eth0\nip addr show\nping 10.10.12.1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2-system-preparation",children:"2. System Preparation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Update system\nzypper --non-interactive update\n\n# Install required packages\nzypper install -y \\\n  qemu-kvm \\\n  libvirt \\\n  virt-install \\\n  virt-manager \\\n  bridge-utils \\\n  apache2 \\\n  tftp \\\n  syslinux \\\n  lvm2 \\\n  git \\\n  vim \\\n  tmux\n\n# Enable services\nsystemctl enable --now libvirtd apache2 tftp.socket\n\n# Allow HTTP through firewall\nfirewall-cmd --permanent --add-service=http\nfirewall-cmd --permanent --add-service=tftp\nfirewall-cmd --permanent --add-port=8080/tcp\nfirewall-cmd --reload\n"})}),"\n",(0,r.jsx)(n.h2,{id:"3-lvm-setup-for-vm-disks",children:"3. LVM Setup for VM Disks"}),"\n",(0,r.jsx)(n.p,{children:"The remaining NVMe space becomes an LVM volume group hosting three infrastructure VMs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Identify the PV partition (adjust device name as needed)\nPV_DEV=/dev/nvme0n1p4\n\n# Create PV and VG\npvcreate ${PV_DEV}\nvgcreate vg-infra ${PV_DEV}\n\n# Create logical volumes for VMs\nlvcreate -L 40G -n lv-nuc-00-01 vg-infra\nlvcreate -L 40G -n lv-nuc-00-02 vg-infra\nlvcreate -L 40G -n lv-nuc-00-03 vg-infra\n\n# Verify\nvgs\nlvs\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-apache-pxe-http-server",children:"4. Apache PXE HTTP Server"}),"\n",(0,r.jsxs)(n.p,{children:["Harvester nodes will download their OS over HTTP from ",(0,r.jsx)(n.code,{children:"nuc-00"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create document root for Harvester files\nmkdir -p /var/www/html/harvester\n\n# Mount or copy Harvester ISO contents\nmount -o loop /path/to/harvester-v1.7.1-amd64.iso /mnt/harvester-iso\ncp -r /mnt/harvester-iso/* /var/www/html/harvester/\numount /mnt/harvester-iso\n\n# Test HTTP access\ncurl http://10.10.12.10/harvester/\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-tftp-pxe-boot-server",children:"5. TFTP PXE Boot Server"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Copy pxelinux files to TFTP root\nmkdir -p /var/lib/tftpboot/pxelinux.cfg\ncp /usr/share/syslinux/{pxelinux.0,ldlinux.c32,libcom32.c32,libutil.c32,vesamenu.c32} \\\n   /var/lib/tftpboot/\n\n# Create default PXE menu\ncat > /var/lib/tftpboot/pxelinux.cfg/default << 'EOF'\nDEFAULT menu.c32\nPROMPT 0\nTIMEOUT 50\nMENU TITLE Kubernerdes Enclave PXE Boot\n\nLABEL harvester\n  MENU LABEL Install Harvester\n  KERNEL harvester/vmlinuz\n  APPEND initrd=harvester/initrd ip=dhcp rd.cos.disable rd.noverifyssl \\\n    console=tty1 root=live:http://10.10.12.10/harvester/rootfs.squashfs \\\n    harvester.install.automatic=true \\\n    harvester.install.config_url=http://10.10.12.10/harvester/config-HOSTNAME.yaml\n\nLABEL local\n  MENU LABEL Boot from local disk\n  LOCALBOOT 0\nEOF\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Per-node Harvester config files are served from ",(0,r.jsx)(n.code,{children:"/var/www/html/harvester/"}),". See ",(0,r.jsx)(n.a,{href:"/docs/day-1/harvester-cluster",children:"Harvester Cluster"})," for config file content."]}),"\n",(0,r.jsx)(n.h2,{id:"6-ssh-key-distribution",children:"6. SSH Key Distribution"}),"\n",(0,r.jsx)(n.p,{children:"Generate and distribute the admin SSH key:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# On your workstation\nssh-keygen -t ed25519 -C "enclave-admin" -f ~/.ssh/id_enclave\n\n# Copy to nuc-00\nssh-copy-id -i ~/.ssh/id_enclave.pub mansible@10.10.12.10\n'})}),"\n",(0,r.jsxs)(n.p,{children:["From ",(0,r.jsx)(n.code,{children:"nuc-00"}),", the same key will be pushed to VMs during their creation."]}),"\n",(0,r.jsx)(n.h2,{id:"7-verification",children:"7. Verification"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# KVM is running\nsystemctl is-active libvirtd\nvirsh list --all\n\n# Apache is serving files\ncurl -s -o /dev/null -w "%{http_code}" http://10.10.12.10/harvester/\n# Expected: 200\n\n# TFTP is running\nsystemctl is-active tftp.socket\n\n# LVM is ready\nlvs vg-infra\n# Should show lv-nuc-00-01, lv-nuc-00-02, and lv-nuc-00-03\n\n# Network reachability to switch/uplink\nping -c 4 10.10.12.1\n'})}),"\n",(0,r.jsxs)(n.p,{children:["All checks passing? Proceed to ",(0,r.jsx)(n.a,{href:"/docs/day-1/infrastructure-vms",children:"Infrastructure VMs"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var s=t(6540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);