"use strict";(globalThis.webpackChunkdocs_enclave_kubernerdes_com=globalThis.webpackChunkdocs_enclave_kubernerdes_com||[]).push([[612],{7437(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"day-2/monitoring","title":"Monitoring","description":"Dashboards Available","source":"@site/docs/day-2/monitoring.md","sourceDirName":"day-2","slug":"/day-2/monitoring","permalink":"/docs/day-2/monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/jradtke-rgs/docs.enclave.kubernerdes.com/edit/main/docs/day-2/monitoring.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"monitoring","title":"Monitoring","sidebar_label":"Monitoring","sidebar_position":2},"sidebar":"enclaveSidebar","previous":{"title":"Overview","permalink":"/docs/day-2/"},"next":{"title":"Backup & Maintenance","permalink":"/docs/day-2/backup-maintenance"}}');var t=r(4848),a=r(8453);const i={id:"monitoring",title:"Monitoring",sidebar_label:"Monitoring",sidebar_position:2},c="Monitoring",l={},o=[{value:"Dashboards Available",id:"dashboards-available",level:2},{value:"Harvester Dashboard",id:"harvester-dashboard",level:2},{value:"Node Health Check",id:"node-health-check",level:3},{value:"Rancher Dashboard",id:"rancher-dashboard",level:2},{value:"Enable Rancher Monitoring (Optional)",id:"enable-rancher-monitoring-optional",level:3},{value:"HAProxy Stats Page",id:"haproxy-stats-page",level:2},{value:"Key Metrics to Watch",id:"key-metrics-to-watch",level:2},{value:"Storage (Longhorn)",id:"storage-longhorn",level:3},{value:"etcd Health",id:"etcd-health",level:3},{value:"Certificate Expiry",id:"certificate-expiry",level:3},{value:"Alerting",id:"alerting",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"monitoring",children:"Monitoring"})}),"\n",(0,t.jsx)(n.h2,{id:"dashboards-available",children:"Dashboards Available"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Dashboard"}),(0,t.jsx)(n.th,{children:"URL"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Harvester UI"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://10.10.12.100",children:"https://10.10.12.100"})}),(0,t.jsx)(n.td,{children:"Cluster nodes, VMs, storage, networking"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Rancher Manager"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://10.10.12.210",children:"https://10.10.12.210"})}),(0,t.jsx)(n.td,{children:"Multi-cluster overview, workload health"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HAProxy Stats"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"http://10.10.12.93:9000/stats",children:"http://10.10.12.93:9000/stats"})}),(0,t.jsx)(n.td,{children:"Load balancer backend health, traffic"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Longhorn UI"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"https://10.10.12.100",children:"https://10.10.12.100"})," \u2192 Storage \u2192 Longhorn"]}),(0,t.jsx)(n.td,{children:"Volume health, replica status"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"harvester-dashboard",children:"Harvester Dashboard"}),"\n",(0,t.jsxs)(n.p,{children:["Access the Harvester UI at ",(0,t.jsx)(n.code,{children:"https://10.10.12.100"})," (or ",(0,t.jsx)(n.code,{children:"https://harvester-edge.enclave.kubernerdes.com"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"Key views:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dashboard"})," \u2014 cluster-wide CPU/memory/storage utilization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hosts"})," \u2014 per-node resource usage, disk health, network"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Virtual Machines"})," \u2014 running VMs, their state, and console access"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Volumes"})," \u2014 Longhorn PVC status, replica counts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Networks"})," \u2014 VM network interfaces and bridge configuration"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"node-health-check",children:"Node Health Check"}),"\n",(0,t.jsxs)(n.p,{children:["From the Harvester UI \u2192 ",(0,t.jsx)(n.strong,{children:"Hosts"}),", each node should show:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["State: ",(0,t.jsx)(n.code,{children:"Active"})]}),"\n",(0,t.jsxs)(n.li,{children:["Disk: ",(0,t.jsx)(n.code,{children:"Schedulable"})]}),"\n",(0,t.jsx)(n.li,{children:"Memory: reasonable headroom (alert if > 85% used)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"From the command line:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Node conditions\nkubectl get nodes -o custom-columns=\\\n'NAME:.metadata.name,STATUS:.status.conditions[-1].type,REASON:.status.conditions[-1].reason'\n\n# Resource pressure\nkubectl top nodes\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rancher-dashboard",children:"Rancher Dashboard"}),"\n",(0,t.jsxs)(n.p,{children:["Access at ",(0,t.jsx)(n.code,{children:"https://10.10.12.210"})," (or ",(0,t.jsx)(n.code,{children:"https://rancher.enclave.kubernerdes.com"}),")."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cluster Explorer"})," \u2192 select ",(0,t.jsx)(n.code,{children:"harvester-edge"})," cluster \u2192 workload health"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monitoring"})," \u2192 if you've deployed the rancher-monitoring chart, Grafana dashboards are available here"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fleet"})," \u2192 GitOps-managed workloads across clusters"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"enable-rancher-monitoring-optional",children:"Enable Rancher Monitoring (Optional)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add rancher-charts https://charts.rancher.com\nhelm install rancher-monitoring rancher-charts/rancher-monitoring \\\n  --namespace cattle-monitoring-system \\\n  --create-namespace \\\n  --kubeconfig ~/.kube/harvester-config \\\n  --set prometheus.prometheusSpec.resources.requests.memory=512Mi \\\n  --set prometheus.prometheusSpec.resources.limits.memory=2Gi\n"})}),"\n",(0,t.jsx)(n.p,{children:"This deploys Prometheus + Grafana + Alertmanager into the Harvester cluster. Access Grafana via Rancher UI \u2192 Monitoring \u2192 Grafana."}),"\n",(0,t.jsx)(n.h2,{id:"haproxy-stats-page",children:"HAProxy Stats Page"}),"\n",(0,t.jsx)(n.p,{children:"The HAProxy stats page provides real-time load balancer visibility."}),"\n",(0,t.jsxs)(n.p,{children:["Access at: ",(0,t.jsx)(n.a,{href:"http://10.10.12.93:9000/stats",children:"http://10.10.12.93:9000/stats"})," (credentials: admin/rancher)"]}),"\n",(0,t.jsx)(n.p,{children:"Key metrics to monitor:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Metric"}),(0,t.jsx)(n.th,{children:"Healthy"}),(0,t.jsx)(n.th,{children:"Alert"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Backend UP count"}),(0,t.jsx)(n.td,{children:"= configured backend count"}),(0,t.jsx)(n.td,{children:"Any backend DOWN"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Session rate"}),(0,t.jsx)(n.td,{children:"Baseline normal"}),(0,t.jsx)(n.td,{children:"Sudden spike"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Error rate"}),(0,t.jsx)(n.td,{children:"~0"}),(0,t.jsx)(n.td,{children:"> 0.1%"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"From the command line (on nuc-00-03):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check HAProxy backend status via socket\necho \"show stat\" | socat stdio /var/run/haproxy/admin.sock | cut -d',' -f1,2,18,19\n"})}),"\n",(0,t.jsx)(n.h2,{id:"key-metrics-to-watch",children:"Key Metrics to Watch"}),"\n",(0,t.jsx)(n.h3,{id:"storage-longhorn",children:"Storage (Longhorn)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Overall storage health\nkubectl get volumes -n longhorn-system\n\n# Degraded volumes (replicas not fully replicated)\nkubectl get volumes -n longhorn-system \\\n  -o custom-columns='NAME:.metadata.name,STATE:.status.state,ROBUSTNESS:.status.robustness' | \\\n  grep -v healthy\n\n# Disk space\nkubectl get nodes.longhorn.io -n longhorn-system\n"})}),"\n",(0,t.jsx)(n.p,{children:"Alert thresholds:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Volume robustness ",(0,t.jsx)(n.code,{children:"degraded"}),": investigate within 24h"]}),"\n",(0,t.jsxs)(n.li,{children:["Volume robustness ",(0,t.jsx)(n.code,{children:"faulted"}),": immediate action required"]}),"\n",(0,t.jsx)(n.li,{children:"Disk usage > 80%: plan expansion or cleanup"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"etcd-health",children:"etcd Health"}),"\n",(0,t.jsx)(n.p,{children:"Harvester's control plane uses etcd. Check its health periodically:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# SSH to any Harvester node\nssh rancher@10.10.12.101\n\n# etcd health\nkubectl get pods -n kube-system | grep etcd\ncrictl ps | grep etcd\n\n# etcd endpoint health (from inside nuc-01)\nETCDCTL_API=3 etcdctl \\\n  --endpoints=https://127.0.0.1:2379 \\\n  --cacert=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt \\\n  --cert=/var/lib/rancher/k3s/server/tls/etcd/server-client.crt \\\n  --key=/var/lib/rancher/k3s/server/tls/etcd/server-client.key \\\n  endpoint health\n"})}),"\n",(0,t.jsx)(n.h3,{id:"certificate-expiry",children:"Certificate Expiry"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check all cert-manager certificates\nkubectl --kubeconfig ~/.kube/rancher-k3s-config \\\n  get certificates -A\n\n# Check expiry\nkubectl --kubeconfig ~/.kube/rancher-k3s-config \\\n  get certificates -A -o \\\n  custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,READY:.status.conditions[-1].status,EXPIRY:.status.notAfter'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Certificates managed by cert-manager renew automatically at 2/3 of their lifetime. If a certificate is stuck ",(0,t.jsx)(n.code,{children:"NotReady"}),", see ",(0,t.jsx)(n.a,{href:"/docs/day-2/troubleshooting#certificate-issues",children:"Troubleshooting"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"alerting",children:"Alerting"}),"\n",(0,t.jsx)(n.p,{children:"Basic alerting can be configured via:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rancher Monitoring Alertmanager"})," \u2014 email/Slack/PagerDuty alerts for pod failures, node pressure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keepalived"})," \u2014 log to syslog when VIP transitions (visible in ",(0,t.jsx)(n.code,{children:"journalctl -u keepalived"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HAProxy"})," \u2014 log backend state changes to syslog"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Watch HAProxy state changes in real time (on nuc-00-03)\njournalctl -u haproxy -f | grep -E "Server|backend"\n\n# Watch Keepalived VIP transitions (on nuc-00-03)\njournalctl -u keepalived -f\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>c});var s=r(6540);const t={},a=s.createContext(t);function i(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);