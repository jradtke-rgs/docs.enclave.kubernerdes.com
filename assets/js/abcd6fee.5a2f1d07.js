"use strict";(globalThis.webpackChunkdocs_enclave_kubernerdes_com=globalThis.webpackChunkdocs_enclave_kubernerdes_com||[]).push([[117],{8800(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>o,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"day-1/rancher-manager","title":"Rancher Manager","description":"Rancher Manager is deployed as a 3-node K3s HA cluster, running as VMs inside the Harvester cluster. It provides the central Kubernetes management UI and multi-cluster fleet management.","source":"@site/docs/day-1/rancher-manager.md","sourceDirName":"day-1","slug":"/day-1/rancher-manager","permalink":"/docs/day-1/rancher-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/jradtke-rgs/docs.enclave.kubernerdes.com/edit/main/docs/day-1/rancher-manager.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"rancher-manager","title":"Rancher Manager","sidebar_label":"Rancher Manager","sidebar_position":5},"sidebar":"enclaveSidebar","previous":{"title":"Harvester Cluster","permalink":"/docs/day-1/harvester-cluster"},"next":{"title":"Overview","permalink":"/docs/day-2/"}}');var a=r(4848),t=r(8453);const c={id:"rancher-manager",title:"Rancher Manager",sidebar_label:"Rancher Manager",sidebar_position:5},i="Rancher Manager",l={},d=[{value:"Architecture",id:"architecture",level:2},{value:"Step 1: Create the Rancher Manager VMs",id:"step-1-create-the-rancher-manager-vms",level:2},{value:"Step 2: Install K3s",id:"step-2-install-k3s",level:2},{value:"On rancher-01 (init node)",id:"on-rancher-01-init-node",level:3},{value:"On rancher-02 and rancher-03 (join nodes)",id:"on-rancher-02-and-rancher-03-join-nodes",level:3},{value:"Verify all nodes joined",id:"verify-all-nodes-joined",level:3},{value:"Retrieve kubeconfig",id:"retrieve-kubeconfig",level:3},{value:"Step 3: Install cert-manager",id:"step-3-install-cert-manager",level:2},{value:"Step 4: Install Rancher Manager",id:"step-4-install-rancher-manager",level:2},{value:"Step 5: Confirm HAProxy Routing",id:"step-5-confirm-haproxy-routing",level:2},{value:"Step 6: Import Harvester Cluster into Rancher",id:"step-6-import-harvester-cluster-into-rancher",level:2},{value:"Verification",id:"verification",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"rancher-manager",children:"Rancher Manager"})}),"\n",(0,a.jsx)(n.p,{children:"Rancher Manager is deployed as a 3-node K3s HA cluster, running as VMs inside the Harvester cluster. It provides the central Kubernetes management UI and multi-cluster fleet management."}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Harvester cluster\n\u2514\u2500\u2500 rancher-01 VM (10.10.12.211)  \u2500\u2510\n\u2514\u2500\u2500 rancher-02 VM (10.10.12.212)  \u2500\u253c\u2500 K3s HA cluster\n\u2514\u2500\u2500 rancher-03 VM (10.10.12.213)  \u2500\u2518\n    \u251c\u2500\u2500 cert-manager (TLS certificates)\n    \u2514\u2500\u2500 Rancher Manager (Helm chart)\n        \u2514\u2500\u2500 Exposed via: 10.10.12.210 (Keepalived VIP \u2192 HAProxy on nuc-00-03)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-1-create-the-rancher-manager-vms",children:"Step 1: Create the Rancher Manager VMs"}),"\n",(0,a.jsxs)(n.p,{children:["In the Harvester UI (",(0,a.jsx)(n.code,{children:"https://10.10.12.100"}),"), create three VMs with the following configuration:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Setting"}),(0,a.jsx)(n.th,{children:"Value"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Names"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"rancher-01"}),", ",(0,a.jsx)(n.code,{children:"rancher-02"}),", ",(0,a.jsx)(n.code,{children:"rancher-03"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"CPU"}),(0,a.jsx)(n.td,{children:"4 vCPUs each"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Memory"}),(0,a.jsx)(n.td,{children:"8 GB each"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Image"}),(0,a.jsx)(n.td,{children:"openSUSE Leap 15.5 (upload ISO first)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Disk"}),(0,a.jsx)(n.td,{children:"60 GB (Longhorn) each"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Network"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"default"})," (management)"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"IPs"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"10.10.12.211"}),", ",(0,a.jsx)(n.code,{children:"10.10.12.212"}),", ",(0,a.jsx)(n.code,{children:"10.10.12.213"})," (static)"]})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:["Use cloud-init user data to set static IPs at VM creation time. Example for ",(0,a.jsx)(n.code,{children:"rancher-01"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"#cloud-config\nhostname: rancher-01\nmanage_etc_hosts: true\n\nnetwork:\n  version: 2\n  ethernets:\n    eth0:\n      addresses:\n        - 10.10.12.211/22\n      gateway4: 10.10.12.1\n      nameservers:\n        addresses:\n          - 10.10.12.8\n          - 10.10.12.9\n          - 8.8.8.8\n        search:\n          - enclave.kubernerdes.com\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Repeat with IPs ",(0,a.jsx)(n.code,{children:"10.10.12.212"})," and ",(0,a.jsx)(n.code,{children:"10.10.12.213"})," for ",(0,a.jsx)(n.code,{children:"rancher-02"})," and ",(0,a.jsx)(n.code,{children:"rancher-03"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"step-2-install-k3s",children:"Step 2: Install K3s"}),"\n",(0,a.jsxs)(n.p,{children:["Install K3s on all three nodes. ",(0,a.jsx)(n.code,{children:"rancher-01"})," initializes the cluster; ",(0,a.jsx)(n.code,{children:"rancher-02"})," and ",(0,a.jsx)(n.code,{children:"rancher-03"})," join it."]}),"\n",(0,a.jsx)(n.h3,{id:"on-rancher-01-init-node",children:"On rancher-01 (init node)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'export K3S_VERSION="v1.34.4+k3s1"\nexport K3S_TOKEN="Waggoner"\nexport K3S_VIP="10.10.12.210"\n\ncurl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=${K3S_VERSION} sh -s - \\\n  --cluster-init \\\n  --token ${K3S_TOKEN} \\\n  --tls-san ${K3S_VIP} \\\n  --tls-san rancher.enclave.kubernerdes.com \\\n  --node-ip 10.10.12.211 \\\n  --disable traefik\n\n# Wait for K3s to be ready\nkubectl get nodes\n# Expected: rancher-01   Ready   control-plane,master\n'})}),"\n",(0,a.jsx)(n.h3,{id:"on-rancher-02-and-rancher-03-join-nodes",children:"On rancher-02 and rancher-03 (join nodes)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'export K3S_VERSION="v1.34.4+k3s1"\nexport K3S_TOKEN="Waggoner"\n\n# On rancher-02\ncurl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=${K3S_VERSION} sh -s - \\\n  --server https://10.10.12.211:6443 \\\n  --token ${K3S_TOKEN} \\\n  --node-ip 10.10.12.212 \\\n  --disable traefik\n\n# On rancher-03\ncurl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=${K3S_VERSION} sh -s - \\\n  --server https://10.10.12.211:6443 \\\n  --token ${K3S_TOKEN} \\\n  --node-ip 10.10.12.213 \\\n  --disable traefik\n'})}),"\n",(0,a.jsx)(n.h3,{id:"verify-all-nodes-joined",children:"Verify all nodes joined"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n# Expected:\n# NAME         STATUS   ROLES                       AGE\n# rancher-01   Ready    control-plane,etcd,master   ...\n# rancher-02   Ready    control-plane,etcd,master   ...\n# rancher-03   Ready    control-plane,etcd,master   ...\n"})}),"\n",(0,a.jsx)(n.h3,{id:"retrieve-kubeconfig",children:"Retrieve kubeconfig"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Copy Rancher K3s kubeconfig to your workstation\nscp mansible@10.10.12.211:/etc/rancher/k3s/k3s.yaml ~/.kube/rancher-k3s-config\n\n# Update server address to use the VIP\nsed -i 's|https://127.0.0.1:6443|https://10.10.12.210:6443|g' ~/.kube/rancher-k3s-config\n\n# Verify via VIP\nkubectl --kubeconfig ~/.kube/rancher-k3s-config get nodes\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-3-install-cert-manager",children:"Step 3: Install cert-manager"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Add Jetstack Helm repo\nhelm repo add jetstack https://charts.jetstack.io\nhelm repo update\n\n# Install cert-manager\nhelm install cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --version v1.14.0 \\\n  --set crds.enabled=true \\\n  --kubeconfig ~/.kube/rancher-k3s-config\n\n# Verify\nkubectl --kubeconfig ~/.kube/rancher-k3s-config \\\n  get pods -n cert-manager\n# All pods should be Running\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-4-install-rancher-manager",children:"Step 4: Install Rancher Manager"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Add Rancher Prime (RGS) Helm repo\nhelm repo add rancher-prime https://charts.rancher.com/server-charts/prime\nhelm repo update\n\n# Install Rancher\nhelm install rancher rancher-prime/rancher \\\n  --namespace cattle-system \\\n  --create-namespace \\\n  --kubeconfig ~/.kube/rancher-k3s-config \\\n  --set hostname=rancher.enclave.kubernerdes.com \\\n  --set bootstrapPassword=Passw0rd01 \\\n  --set ingress.tls.source=letsEncrypt \\\n  --set letsEncrypt.email=admin@kubernerdes.com \\\n  --set letsEncrypt.ingress.class=nginx \\\n  --set replicas=3\n\n# Watch rollout\nkubectl --kubeconfig ~/.kube/rancher-k3s-config \\\n  rollout status deployment rancher -n cattle-system\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Air-gap note:"})," For offline deployments, use ",(0,a.jsx)(n.code,{children:"ingress.tls.source=secret"})," with a pre-provisioned certificate, and pull Rancher images from your local RGS Carbide registry mirror."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"step-5-confirm-haproxy-routing",children:"Step 5: Confirm HAProxy Routing"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"nuc-00-03"}),"'s HAProxy already has the Rancher backends configured (see ",(0,a.jsx)(n.a,{href:"/docs/day-1/infrastructure-vms",children:"Infrastructure VMs"}),"). The VIP ",(0,a.jsx)(n.code,{children:"10.10.12.210"})," routes through HAProxy to all three Rancher nodes."]}),"\n",(0,a.jsx)(n.p,{children:"Test connectivity:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -k https://10.10.12.210/ping\n# Expected: {"type":"ping"}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"step-6-import-harvester-cluster-into-rancher",children:"Step 6: Import Harvester Cluster into Rancher"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Open Rancher UI: ",(0,a.jsx)(n.code,{children:"https://rancher.enclave.kubernerdes.com"})," (or ",(0,a.jsx)(n.code,{children:"https://10.10.12.210"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"Complete the initial setup (set admin password)"}),"\n",(0,a.jsxs)(n.li,{children:["Navigate to ",(0,a.jsx)(n.strong,{children:"Cluster Management"})," \u2192 ",(0,a.jsx)(n.strong,{children:"Import Existing"})]}),"\n",(0,a.jsxs)(n.li,{children:["Select ",(0,a.jsx)(n.strong,{children:"Generic"})," cluster type"]}),"\n",(0,a.jsxs)(n.li,{children:["Name: ",(0,a.jsx)(n.code,{children:"harvester-edge"})]}),"\n",(0,a.jsxs)(n.li,{children:["Copy the ",(0,a.jsx)(n.code,{children:"kubectl apply"})," command shown"]}),"\n",(0,a.jsx)(n.li,{children:"Run it against the Harvester cluster:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl --kubeconfig ~/.kube/harvester-config apply -f <registration-url>\n"})}),"\n",(0,a.jsx)(n.p,{children:"The Harvester cluster appears as an imported cluster in Rancher after a few minutes."}),"\n",(0,a.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Rancher pods healthy (3 replicas)\nkubectl --kubeconfig ~/.kube/rancher-k3s-config \\\n  get pods -n cattle-system\n\n# Rancher UI reachable via VIP\ncurl -k -s -o /dev/null -w "%{http_code}" https://10.10.12.210\n# Expected: 200 or 302\n\n# Rancher reachable via DNS\ncurl -k -s -o /dev/null -w "%{http_code}" https://rancher.enclave.kubernerdes.com\n# Expected: 200 or 302\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Login with the bootstrap password you set during ",(0,a.jsx)(n.code,{children:"helm install"}),". ",(0,a.jsx)(n.strong,{children:"Change it immediately"})," in the UI."]}),"\n",(0,a.jsxs)(n.p,{children:["Day 1 is complete! Proceed to ",(0,a.jsx)(n.a,{href:"/docs/day-2/",children:"Day 2 \u2014 Operate"}),"."]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453(e,n,r){r.d(n,{R:()=>c,x:()=>i});var s=r(6540);const a={},t=s.createContext(a);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);